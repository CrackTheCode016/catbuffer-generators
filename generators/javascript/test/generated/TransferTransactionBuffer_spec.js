const assert = require('assert');
const JavaScriptUtils = require('../../support/JavaScriptUtils.js');
const { MosaicBuffer } = require('../../../../_generated/js/MosaicBuffer.js');
const { TransferTransactionBuffer } = require('../../../../_generated/js/TransferTransactionBuffer.js');


describe('TransferTransactionBuffer generated class', () => {
	it('has required getters and setters', () => {
		const buffer = new TransferTransactionBuffer();
		buffer.setSize(null);
		buffer.getSize();
		buffer.setSignature(null);
		buffer.getSignature();
		buffer.setSigner(null);
		buffer.getSigner();
		buffer.setVersion(null);
		buffer.getVersion();
		buffer.setType(null);
		buffer.getType();
		buffer.setFee(null);
		buffer.getFee();
		buffer.setDeadline(null);
		buffer.getDeadline();
		buffer.setRecipient(null);
		buffer.getRecipient();
		buffer.setMessage(null);
		buffer.getMessage();
		buffer.setMosaics(null);
		buffer.getMosaics();
	});

	it('loadFromBinary initializes from binary data', () => {
		const mosaicBuffer1 = new MosaicBuffer();
		mosaicBuffer1.mosaicId = new Uint8Array(Buffer.of(0xF2, 0x26, 0x6C, 0x06, 0x40, 0x83, 0xB2, 0x92));
		mosaicBuffer1.amount = new Uint8Array(Buffer.of(0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44));
		const mosaicBuffer2 = new MosaicBuffer();
		const mosaic1 = mosaicBuffer1.serialize();
		mosaicBuffer2.mosaicId = new Uint8Array(Buffer.of(0xF2, 0x26, 0x6C, 0x06, 0x40, 0x83, 0xB2, 0x92));
		mosaicBuffer2.amount = new Uint8Array(Buffer.of(0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44));
		const mosaic2 = mosaicBuffer2.serialize();

		const sizeBuffer = Buffer.of(0xF2, 0x26, 0x6C, 0x06);
		const signatureBuffer = Buffer.of(
			0xF5, 0x24, 0x8C, 0xB0, 0x05, 0x49, 0xC6, 0x15, 0xFC, 0x56, 0x13, 0x08, 0xE3, 0x4B, 0x60, 0xFF,
			0x3E, 0xE9, 0xFA, 0x15, 0xA3, 0xB6, 0x05, 0xDC, 0x0C, 0x4C, 0xF7, 0xF1, 0xB1, 0x5A, 0xAB, 0xDC,
			0xCC, 0x2E, 0x09, 0x59, 0x38, 0x97, 0xF2, 0x69, 0xD9, 0xE2, 0x56, 0x29, 0x2B, 0xF3, 0x52, 0xC0,
			0xE8, 0x34, 0x62, 0x6D, 0x00, 0x3C, 0xBF, 0xC2, 0x18, 0x0D, 0x71, 0xED, 0x25, 0x72, 0x3F, 0x48
		);
		const signerBuffer = Buffer.of(
			0x3E, 0xE9, 0xFA, 0x15, 0xA3, 0xB6, 0x05, 0xDC, 0x0C, 0x4C, 0xF7, 0xF1, 0xB1, 0x5A, 0xAB, 0xDC,
			0xE8, 0x34, 0x62, 0x6D, 0x00, 0x3C, 0xBF, 0xC2, 0x18, 0x0D, 0x71, 0xED, 0x25, 0x72, 0x3F, 0x48
		);
		const versionBuffer = Buffer.of(0xFF, 0x36);
		const typeBuffer = Buffer.of(0x22, 0x66);
		const feeBuffer = Buffer.of(0xB6, 0x05, 0xDC, 0x0C, 0x4C, 0xF7, 0xF2, 0x06);
		const deadlineBuffer = Buffer.of(0xF2, 0x26, 0x0C, 0x4C, 0xF7, 0xF1, 0x6C, 0x06);
		const recipientBuffer = Buffer.of(
			0x3E, 0xE9, 0xFA, 0x15, 0xA3, 0xB6, 0x05, 0xDC, 0x0C, 0x4C, 0xF7, 0xF1, 0xB1, 0x5A, 0xAB, 0xDC,
			0xCC, 0x2E, 0x09, 0x59, 0x38, 0x97, 0xF2, 0x69, 0xD9
		);
		const messageSizeBuffer = Buffer.of(0x12, 0x00);
		const mosaicsCountBuffer = Buffer.of(0x02);
		const messageBuffer = Buffer.of(
			0x05, 0xDC, 0x05, 0xDC, 0x05, 0xDC, 0x05, 0xDC, 0x05, 0xDC, 0x05, 0xDC, 0x05, 0xDC, 0x05, 0xDC,
			0x05, 0xDC
		);
		const mosaicsBuffer = Buffer.concat([
			mosaic1,
			mosaic2
		]);
		const consumableBuffer = new JavaScriptUtils.Uint8ArrayConsumableBuffer(new Uint8Array(Buffer.concat([
			sizeBuffer,
			signatureBuffer,
			signerBuffer,
			versionBuffer,
			typeBuffer,
			feeBuffer,
			deadlineBuffer,
			recipientBuffer,
			messageSizeBuffer,
			mosaicsCountBuffer,
			messageBuffer,
			mosaicsBuffer
		])));
		const buffer = TransferTransactionBuffer.loadFromBinary(consumableBuffer);

		assert.deepEqual(buffer.size, sizeBuffer);
		assert.deepEqual(buffer.signature, signatureBuffer);
		assert.deepEqual(buffer.signer, signerBuffer);
		assert.deepEqual(buffer.version, versionBuffer);
		assert.deepEqual(buffer.type, typeBuffer);
		assert.deepEqual(buffer.fee, feeBuffer);
		assert.deepEqual(buffer.deadline, deadlineBuffer);
		assert.deepEqual(buffer.recipient, recipientBuffer);
		assert.deepEqual(buffer.message, messageBuffer);
		assert.deepEqual(buffer.mosaics.length, 2);
		assert.deepEqual(buffer.mosaics[0].serialize(), mosaic1);
		assert.deepEqual(buffer.mosaics[1].serialize(), mosaic2);
		assert.equal(consumableBuffer.binary.length, consumableBuffer.offset);
	});

	it('serialize outputs a valid formatted buffer', () => {
		const mosaicBuffer1 = new MosaicBuffer();
		mosaicBuffer1.mosaicId = new Uint8Array(Buffer.of(0xF2, 0x26, 0x6C, 0x06, 0x40, 0x83, 0xB2, 0x92));
		mosaicBuffer1.amount = new Uint8Array(Buffer.of(0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44));
		const mosaicBuffer2 = new MosaicBuffer();
		const mosaic1 = mosaicBuffer1.serialize();
		mosaicBuffer2.mosaicId = new Uint8Array(Buffer.of(0xF2, 0x26, 0x6C, 0x06, 0x40, 0x83, 0xB2, 0x92));
		mosaicBuffer2.amount = new Uint8Array(Buffer.of(0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44));
		const mosaic2 = mosaicBuffer2.serialize();

		const sizeBuffer = Buffer.of(0xF2, 0x26, 0x6C, 0x06);
		const signatureBuffer = Buffer.of(
			0xF5, 0x24, 0x8C, 0xB0, 0x05, 0x49, 0xC6, 0x15, 0xFC, 0x56, 0x13, 0x08, 0xE3, 0x4B, 0x60, 0xFF,
			0x3E, 0xE9, 0xFA, 0x15, 0xA3, 0xB6, 0x05, 0xDC, 0x0C, 0x4C, 0xF7, 0xF1, 0xB1, 0x5A, 0xAB, 0xDC,
			0xCC, 0x2E, 0x09, 0x59, 0x38, 0x97, 0xF2, 0x69, 0xD9, 0xE2, 0x56, 0x29, 0x2B, 0xF3, 0x52, 0xC0,
			0xE8, 0x34, 0x62, 0x6D, 0x00, 0x3C, 0xBF, 0xC2, 0x18, 0x0D, 0x71, 0xED, 0x25, 0x72, 0x3F, 0x48
		);
		const signerBuffer = Buffer.of(
			0x3E, 0xE9, 0xFA, 0x15, 0xA3, 0xB6, 0x05, 0xDC, 0x0C, 0x4C, 0xF7, 0xF1, 0xB1, 0x5A, 0xAB, 0xDC,
			0xE8, 0x34, 0x62, 0x6D, 0x00, 0x3C, 0xBF, 0xC2, 0x18, 0x0D, 0x71, 0xED, 0x25, 0x72, 0x3F, 0x48
		);
		const versionBuffer = Buffer.of(0xFF, 0x36);
		const typeBuffer = Buffer.of(0x22, 0x66);
		const feeBuffer = Buffer.of(0xB6, 0x05, 0xDC, 0x0C, 0x4C, 0xF7, 0xF2, 0x06);
		const deadlineBuffer = Buffer.of(0xF2, 0x26, 0x0C, 0x4C, 0xF7, 0xF1, 0x6C, 0x06);
		const recipientBuffer = Buffer.of(
			0x3E, 0xE9, 0xFA, 0x15, 0xA3, 0xB6, 0x05, 0xDC, 0x0C, 0x4C, 0xF7, 0xF1, 0xB1, 0x5A, 0xAB, 0xDC,
			0xCC, 0x2E, 0x09, 0x59, 0x38, 0x97, 0xF2, 0x69, 0xD9
		);
		const messageSizeBuffer = Buffer.of(0x12, 0x00);
		const mosaicsCountBuffer = Buffer.of(0x02);
		const messageBuffer = Buffer.of(
			0x05, 0xDC, 0x05, 0xDC, 0x05, 0xDC, 0x05, 0xDC, 0x05, 0xDC, 0x05, 0xDC, 0x05, 0xDC, 0x05, 0xDC,
			0x05, 0xDC
		);
		const mosaicsBuffer = Buffer.concat([
			mosaic1,
			mosaic2
		]);

		const buffer = new TransferTransactionBuffer();
		buffer.size = sizeBuffer;
		buffer.signature = signatureBuffer;
		buffer.signer = signerBuffer;
		buffer.version = versionBuffer;
		buffer.type = typeBuffer;
		buffer.fee = feeBuffer;
		buffer.deadline = deadlineBuffer;
		buffer.recipient = recipientBuffer;
		buffer.message = messageBuffer;
		buffer.mosaics = [mosaicBuffer1, mosaicBuffer2];

		const serializedData = buffer.serialize();
		assert.deepEqual(serializedData, Buffer.concat([
			sizeBuffer,
			signatureBuffer,
			signerBuffer,
			versionBuffer,
			typeBuffer,
			feeBuffer,
			deadlineBuffer,
			recipientBuffer,
			messageSizeBuffer,
			mosaicsCountBuffer,
			messageBuffer,
			mosaicsBuffer
		]));
	});
});
